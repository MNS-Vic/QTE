# QTE 交易所性能测试

本目录包含QTE交易所的性能测试，用于评估系统在不同负载下的性能表现和稳定性。

## WebSocket订单性能测试

WebSocket订单性能测试评估订单处理和通知的速度、延迟和吞吐量。

### 测试文件

- `test_websocket_order_performance.py`: 订单处理性能测试，测量订单通知延迟和吞吐量

### 测试指标

1. **延迟 (Latency)**:
   - 从订单提交到收到通知的时间
   - 统计平均延迟、最小延迟、最大延迟和P95延迟

2. **吞吐量 (Throughput)**:
   - 单位时间内能处理的订单数量
   - 测量在高并发下的订单处理速度

3. **稳定性 (Stability)**:
   - 长时间运行下的性能表现
   - 资源使用情况(内存、CPU)随时间的变化

### 测试设置

性能测试使用以下配置:

- 测试环境: 本地环境（单机模拟）
- 模拟客户端数: 可配置（默认测试中使用1-100个客户端）
- 订单类型: 市价单和限价单
- 测试持续时间: 可配置（秒到分钟级别）

## 运行性能测试

可以使用以下命令运行所有性能测试:

```bash
pytest tests/performance
```

或者运行特定的性能测试:

```bash
pytest tests/performance/test_websocket_order_performance.py
```

## 性能阈值

当前性能测试的通过阈值:

- 平均延迟: < 100ms
- P95延迟: < 250ms
- 吞吐量: > 10 订单/秒

这些阈值可以根据生产环境的需求进行调整。

## 注意事项

1. 性能测试可能会占用大量系统资源，建议在独立环境中运行
2. 测试结果可能会受到运行环境的影响，应该在相同环境下比较测试结果
3. 对于长时间运行的性能测试，建议使用专门的性能测试工具
4. 某些性能测试可能没有严格的断言，主要是用于收集性能数据

## 性能优化建议

如果性能测试未达到预期:

1. 检查数据结构和算法的效率
2. 优化数据库查询和缓存
3. 考虑增加WebSocket服务器或撮合引擎的并发处理能力
4. 分析资源瓶颈(CPU、内存、网络)并有针对性地优化 