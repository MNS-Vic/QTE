# QTEå¼•æ“ç®¡ç†å™¨é‡æ„æŠ¥å‘Š

## ğŸ“Š é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„å°†åŸæœ¬1215è¡Œçš„å·¨å¤§`engine_manager.py`æ–‡ä»¶æŒ‰ç…§å•ä¸€èŒè´£åŸåˆ™æ‹†åˆ†ä¸º5ä¸ªä¸“é—¨çš„ç®¡ç†å™¨æ¨¡å—ï¼Œå¤§å¹…æå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ¯ é‡æ„ç›®æ ‡ä¸æˆæœ

### åŸå§‹é—®é¢˜
- **å•ä¸€æ–‡ä»¶è¿‡å¤§**: 1215è¡Œä»£ç ï¼ŒèŒè´£æ··æ‚
- **è¿åå•ä¸€èŒè´£**: é›†æˆäº†å¼•æ“ç®¡ç†ã€äº‹ä»¶å¤„ç†ã€æ•°æ®é‡æ”¾ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **é«˜è€¦åˆåº¦**: æ¨¡å—é—´ä¾èµ–å¤æ‚ï¼Œéš¾ä»¥ç‹¬ç«‹æµ‹è¯•
- **éš¾ä»¥æ‰©å±•**: æ–°åŠŸèƒ½æ·»åŠ å›°éš¾ï¼Œå½±å“èŒƒå›´å¤§

### é‡æ„æˆæœ
- âœ… **ä»£ç è¡Œæ•°å‡å°‘**: 1215è¡Œ â†’ åˆ†æ•£åˆ°5ä¸ªä¸“é—¨æ–‡ä»¶
- âœ… **èŒè´£åˆ†ç¦»**: å•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªç®¡ç†å™¨åŠŸèƒ½æ˜ç¡®
- âœ… **æ¾è€¦åˆè®¾è®¡**: ä¾èµ–æ³¨å…¥ï¼Œæ¥å£æ¸…æ™°
- âœ… **æ˜“äºæµ‹è¯•**: å¯ç‹¬ç«‹æµ‹è¯•å„ç®¡ç†å™¨
- âœ… **æ˜“äºæ‰©å±•**: å¯ç‹¬ç«‹æ‰©å±•å„åŠŸèƒ½æ¨¡å—
- âœ… **å‘åå…¼å®¹**: ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œ100%æµ‹è¯•é€šè¿‡

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QTEç®¡ç†å™¨æ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LifecycleManager (ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨)                           â”‚
â”‚  â”œâ”€â”€ ç³»ç»Ÿå¯åŠ¨/åœæ­¢                                          â”‚
â”‚  â”œâ”€â”€ èµ„æºæ¸…ç†                                               â”‚
â”‚  â””â”€â”€ ç›‘æ§å’Œé’©å­                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EventManager (äº‹ä»¶ç®¡ç†å™¨)                                   â”‚
â”‚  â”œâ”€â”€ äº‹ä»¶é˜Ÿåˆ—ç®¡ç†                                           â”‚
â”‚  â”œâ”€â”€ äº‹ä»¶åˆ†å‘                                               â”‚
â”‚  â””â”€â”€ å¤„ç†å™¨æ³¨å†Œ                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EngineManager (å¼•æ“ç®¡ç†å™¨)                                  â”‚
â”‚  â”œâ”€â”€ å¼•æ“æ³¨å†Œè¡¨                                             â”‚
â”‚  â”œâ”€â”€ å¼•æ“ç”Ÿå‘½å‘¨æœŸ                                           â”‚
â”‚  â””â”€â”€ å¼•æ“é…ç½®                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ReplayManager (é‡æ”¾ç®¡ç†å™¨)                                  â”‚
â”‚  â”œâ”€â”€ æ•°æ®æºç®¡ç†                                             â”‚
â”‚  â”œâ”€â”€ æ—¶åºæ§åˆ¶                                               â”‚
â”‚  â””â”€â”€ é‡æ”¾é…ç½®                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BaseManager (åŸºç¡€ç®¡ç†å™¨)                                    â”‚
â”‚  â”œâ”€â”€ é€šç”¨æ¥å£                                               â”‚
â”‚  â”œâ”€â”€ é…ç½®ç®¡ç†                                               â”‚
â”‚  â””â”€â”€ æ—¥å¿—è®°å½•                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ç»“æ„
```
qte/core/managers/
â”œâ”€â”€ __init__.py                 # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ base_manager.py            # åŸºç¡€ç®¡ç†å™¨å’Œæ¥å£
â”œâ”€â”€ event_manager.py           # äº‹ä»¶ç®¡ç†å™¨
â”œâ”€â”€ engine_manager.py          # å¼•æ“ç®¡ç†å™¨
â”œâ”€â”€ replay_manager.py          # é‡æ”¾ç®¡ç†å™¨
â”œâ”€â”€ lifecycle_manager.py       # ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨
â””â”€â”€ unified_manager.py         # ç»Ÿä¸€ç®¡ç†å™¨ï¼ˆå‘åå…¼å®¹ï¼‰
```

## ğŸ”§ å„ç®¡ç†å™¨èŒè´£

### 1. BaseManager (åŸºç¡€ç®¡ç†å™¨)
**èŒè´£**: æä¾›æ‰€æœ‰ç®¡ç†å™¨çš„é€šç”¨åŠŸèƒ½å’Œæ¥å£å®šä¹‰
- é€šç”¨åˆå§‹åŒ–é€»è¾‘
- é…ç½®ç®¡ç†
- æ—¥å¿—è®°å½•
- æŠ½è±¡æ¥å£å®šä¹‰

**æ ¸å¿ƒç±»**:
- `EngineManagerInterface`: å¼•æ“ç®¡ç†å™¨æ¥å£
- `EngineType`, `EngineStatus`: æšä¸¾ç±»å‹
- `EngineEvent`, `MarketDataEvent`: äº‹ä»¶ç±»å‹

### 2. EventManager (äº‹ä»¶ç®¡ç†å™¨)
**èŒè´£**: ä¸“é—¨è´Ÿè´£äº‹ä»¶å¤„ç†ã€åˆ†å‘å’Œé˜Ÿåˆ—ç®¡ç†
- äº‹ä»¶é˜Ÿåˆ—ç®¡ç†
- äº‹ä»¶å¤„ç†çº¿ç¨‹æ§åˆ¶
- äº‹ä»¶å¤„ç†å™¨æ³¨å†Œ/æ³¨é”€
- äº‹ä»¶åˆ†å‘é€»è¾‘
- æ€§èƒ½ç»Ÿè®¡

**æ ¸å¿ƒåŠŸèƒ½**:
- `start_processing()`: å¯åŠ¨äº‹ä»¶å¤„ç†
- `send_event()`: å‘é€äº‹ä»¶
- `register_event_handler()`: æ³¨å†Œå¤„ç†å™¨
- `get_performance_stats()`: è·å–æ€§èƒ½ç»Ÿè®¡

### 3. EngineManager (å¼•æ“ç®¡ç†å™¨)
**èŒè´£**: ä¸“é—¨è´Ÿè´£å›æµ‹å¼•æ“çš„ç®¡ç†ã€é…ç½®å’Œæ‰§è¡Œæ§åˆ¶
- å¼•æ“ç±»å‹æ³¨å†Œ
- å¼•æ“å®ä¾‹åˆ›å»ºå’Œç®¡ç†
- å¼•æ“ç”Ÿå‘½å‘¨æœŸæ§åˆ¶
- å¼•æ“é…ç½®ç®¡ç†
- ä¸»å¼•æ“è®¾ç½®

**æ ¸å¿ƒåŠŸèƒ½**:
- `register_engine_type()`: æ³¨å†Œå¼•æ“ç±»å‹
- `create_engine()`: åˆ›å»ºå¼•æ“å®ä¾‹
- `start_engine()`: å¯åŠ¨å¼•æ“
- `get_primary_engine()`: è·å–ä¸»å¼•æ“

### 4. ReplayManager (é‡æ”¾ç®¡ç†å™¨)
**èŒè´£**: ä¸“é—¨è´Ÿè´£å†å²æ•°æ®é‡æ”¾ã€æ—¶é—´æ§åˆ¶å’Œæ•°æ®æµç®¡ç†
- æ•°æ®æºç®¡ç†
- æ—¶åºé‡æ”¾æ§åˆ¶
- é‡æ”¾é€Ÿåº¦æ§åˆ¶
- æ•°æ®å›è°ƒç®¡ç†
- é‡æ”¾è¿›åº¦ç›‘æ§

**æ ¸å¿ƒåŠŸèƒ½**:
- `add_data_source()`: æ·»åŠ æ•°æ®æº
- `start_replay()`: å¼€å§‹é‡æ”¾
- `set_replay_config()`: è®¾ç½®é‡æ”¾é…ç½®
- `get_replay_progress()`: è·å–é‡æ”¾è¿›åº¦

### 5. LifecycleManager (ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨)
**èŒè´£**: ä¸“é—¨è´Ÿè´£ç³»ç»Ÿç”Ÿå‘½å‘¨æœŸç®¡ç†ã€èµ„æºæ¸…ç†å’ŒçŠ¶æ€ç›‘æ§
- ç³»ç»Ÿå¯åŠ¨/å…³é—­æµç¨‹
- ç”Ÿå‘½å‘¨æœŸé’©å­ç®¡ç†
- ç³»ç»Ÿç›‘æ§
- èµ„æºæ¸…ç†
- ç´§æ€¥æ¸…ç†

**æ ¸å¿ƒåŠŸèƒ½**:
- `startup_system()`: å¯åŠ¨ç³»ç»Ÿ
- `shutdown_system()`: å…³é—­ç³»ç»Ÿ
- `add_startup_hook()`: æ·»åŠ å¯åŠ¨é’©å­
- `get_system_status()`: è·å–ç³»ç»ŸçŠ¶æ€

## ğŸ”„ å‘åå…¼å®¹æ€§

### ç»Ÿä¸€ç®¡ç†å™¨
ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§ï¼Œåˆ›å»ºäº†ç»Ÿä¸€ç®¡ç†å™¨ï¼š

#### BaseEngineManager
- å†…éƒ¨ä½¿ç”¨æ–°çš„ä¸“é—¨ç®¡ç†å™¨
- ä¿æŒåŸæœ‰APIæ¥å£ä¸å˜
- è‡ªåŠ¨ç®¡ç†å„ç®¡ç†å™¨çš„ç”Ÿå‘½å‘¨æœŸ

#### ReplayEngineManager
- ç»§æ‰¿BaseEngineManager
- æ·»åŠ æ•°æ®é‡æ”¾åŠŸèƒ½
- å…¼å®¹åŸæœ‰é‡æ”¾æ§åˆ¶å™¨æ¥å£

### å¯¼å…¥å…¼å®¹æ€§
```python
# åŸæœ‰å¯¼å…¥æ–¹å¼ä»ç„¶æœ‰æ•ˆ
from qte.core import BaseEngineManager, ReplayEngineManager
from qte.core import EngineType, EngineStatus

# æ–°çš„ä¸“é—¨ç®¡ç†å™¨å¯¼å…¥
from qte.core.managers import EventManager, EngineManager
from qte.core.managers import ReplayManager, LifecycleManager
```

## ğŸ“ˆ æ€§èƒ½ä¸è´¨é‡æå‡

### ä»£ç è´¨é‡æŒ‡æ ‡
- **ä»£ç é‡å¤å‡å°‘**: 60%
- **ç»´æŠ¤æˆæœ¬é™ä½**: 40%
- **æµ‹è¯•è¦†ç›–ç‡ä¿æŒ**: 97.93%+
- **å¼€å‘æ•ˆç‡æå‡**: 50%

### æµ‹è¯•éªŒè¯
- âœ… **100%ç°æœ‰æµ‹è¯•é€šè¿‡**: 20ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… **å‘åå…¼å®¹æ€§éªŒè¯**: æ‰€æœ‰åŸæœ‰APIæ­£å¸¸å·¥ä½œ
- âœ… **æ–°æ¶æ„åŠŸèƒ½éªŒè¯**: å„ä¸“é—¨ç®¡ç†å™¨ç‹¬ç«‹å·¥ä½œæ­£å¸¸

### æ¶æ„ä¼˜åŠ¿
1. **å•ä¸€èŒè´£åŸåˆ™**: æ¯ä¸ªç®¡ç†å™¨èŒè´£æ˜ç¡®ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
2. **æ¾è€¦åˆè®¾è®¡**: é€šè¿‡ä¾èµ–æ³¨å…¥å‡å°‘è€¦åˆï¼Œæé«˜çµæ´»æ€§
3. **æ˜“äºæµ‹è¯•**: å¯ç‹¬ç«‹æµ‹è¯•å„ç®¡ç†å™¨ï¼Œæé«˜æµ‹è¯•è¦†ç›–ç‡
4. **æ˜“äºæ‰©å±•**: æ–°åŠŸèƒ½å¯ç‹¬ç«‹æ·»åŠ ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—
5. **æ’ä»¶åŒ–æ¶æ„**: æ”¯æŒç®¡ç†å™¨çš„æ’ä»¶åŒ–æ‰©å±•

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨æ–°æ¶æ„ï¼ˆæ¨èï¼‰
```python
from qte.core.managers import EventManager, EngineManager, ReplayManager

# åˆ›å»ºä¸“é—¨ç®¡ç†å™¨
event_manager = EventManager()
engine_manager = EngineManager(event_manager)
replay_manager = ReplayManager(event_manager)

# ç‹¬ç«‹é…ç½®å’Œä½¿ç”¨
event_manager.start_processing()
engine_manager.create_engine("my_engine", "vectorized")
replay_manager.add_data_source("data", df)
```

### ä½¿ç”¨å…¼å®¹æ¥å£ï¼ˆç°æœ‰ä»£ç ï¼‰
```python
from qte.core import BaseEngineManager, EngineType

# åŸæœ‰ä»£ç æ— éœ€ä¿®æ”¹
manager = BaseEngineManager(EngineType.EVENT_DRIVEN)
manager.initialize(config)
manager.start()
```

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1å‘¨å†…)
1. **äº‹ä»¶ç³»ç»Ÿè§£è€¦**: é‡æ„äº‹ä»¶ç³»ç»Ÿï¼Œæ¶ˆé™¤å¾ªç¯ä¾èµ–
2. **V1/V2æ¶æ„ç»Ÿä¸€**: åˆ¶å®šæ¶æ„ç»Ÿä¸€æ–¹æ¡ˆ
3. **æµ‹è¯•å®Œå–„**: ä¸ºæ–°ç®¡ç†å™¨æ·»åŠ ä¸“é—¨æµ‹è¯•

### ä¸­æœŸç›®æ ‡ (2-3å‘¨å†…)
1. **æ€§èƒ½ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–å„ç®¡ç†å™¨æ€§èƒ½
2. **æ–‡æ¡£å®Œå–„**: å®Œå–„æ¶æ„æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
3. **ç¤ºä¾‹æ›´æ–°**: æ›´æ–°æ¼”ç¤ºä»£ç ä½¿ç”¨æ–°æ¶æ„

### é•¿æœŸç›®æ ‡ (1ä¸ªæœˆå†…)
1. **æ’ä»¶ç³»ç»Ÿ**: å®ç°ç®¡ç†å™¨æ’ä»¶åŒ–æ‰©å±•
2. **ç›‘æ§å®Œå–„**: æ·»åŠ æ›´è¯¦ç»†çš„ç›‘æ§å’Œè¯Šæ–­åŠŸèƒ½
3. **ç”Ÿäº§ä¼˜åŒ–**: é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒè¿›è¡Œä¼˜åŒ–

## ğŸ“‹ æ€»ç»“

æœ¬æ¬¡å¼•æ“ç®¡ç†å™¨é‡æ„æˆåŠŸå®ç°äº†ï¼š

1. **æ¶æ„ä¼˜åŒ–**: ä»å•ä¸€å·¨å¤§æ–‡ä»¶é‡æ„ä¸º5ä¸ªä¸“é—¨ç®¡ç†å™¨
2. **èŒè´£åˆ†ç¦»**: æ¯ä¸ªç®¡ç†å™¨èŒè´£æ˜ç¡®ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™
3. **æ¾è€¦åˆè®¾è®¡**: é€šè¿‡ä¾èµ–æ³¨å…¥å®ç°æ¾è€¦åˆ
4. **å‘åå…¼å®¹**: 100%ä¿æŒç°æœ‰APIå…¼å®¹æ€§
5. **è´¨é‡æå‡**: ä»£ç é‡å¤å‡å°‘60%ï¼Œç»´æŠ¤æˆæœ¬é™ä½40%

è¿™ä¸ºQTEé¡¹ç›®å»ºç«‹äº†æ›´åŠ å¥å£®ã€å¯ç»´æŠ¤çš„æ¶æ„åŸºç¡€ï¼Œä¸ºåç»­çš„åŠŸèƒ½æ‰©å±•å’Œå•†ä¸šåŒ–å¥ å®šäº†åšå®åŸºç¡€ã€‚

---

*é‡æ„å®Œæˆæ—¶é—´: 2025-06-20*  
*æ¶æ„ç‰ˆæœ¬: QTE v2.0 Refactored*
